<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mini.shoppingb.mapper.PurchaseMypageMapper">

    <resultMap id="PurchaseMypageResultMap" type="purchaseMypage">
        <association property="purchaseDTO" javaType="purchase">
            <id property="purchaseNum" column="PURCHASE_NUM"/>
            <result property="purchaseDate" column="PURCHASE_DATE"/>
            <result property="purchasePrice" column="PURCHASE_PRICE"/>
            <result property="deliveryAddr" column="DELIVERY_ADDR"/>
            <result property="deliveryAddrDetail" column="DELIVERY_ADDR_DETAIL"/>
            <result property="deliveryPost" column="DELIVERY_POST"/>
            <result property="deliveryPhone" column="DELIVERY_PHONE"/>
            <result property="message" column="MESSAGE"/>
            <result property="purchaseStatus" column="PURCHASE_STATUS"/>
            <result property="memberNum" column="MEMBER_NUM"/>
        </association>
        <association property="purchaseListDTO" javaType="purchaseList">
            <result property="goodsNum" column="GOODS_NUM"/>
            <result property="purchaseNum" column="PURCHASE_NUM"/>
            <result property="purchaseQty" column="PURCHASE_QTY"/>
            <result property="goodsUnitPrice" column="GOODS_UNIT_PRICE"/>
        </association>
        <association property="goodsDTO" javaType="goods">
            <result property="goodsNum" column="GOODS_NUM"/>
            <result property="goodsName" column="GOODS_NAME"/>
            <result property="goodsMainImage" column="GOODS_MAIN_IMAGE"/>
            <result property="goodsMainStoreImage" column="GOODS_MAIN_STORE_IMAGE"/>
        </association>
    </resultMap>

    <select id="purchaseMypageInfo" parameterType="string" resultMap="PurchaseMypageResultMap">
        select
            p.PURCHASE_NUM,
            p.PURCHASE_DATE,
            p.PURCHASE_PRICE,
            p.DELIVERY_ADDR,
            p.DELIVERY_ADDR_DETAIL,
            p.DELIVERY_POST,
            p.DELIVERY_PHONE,
            p.MESSAGE,
            p.PURCHASE_STATUS,
            pl.PURCHASE_QTY,
            pl.GOODS_UNIT_PRICE,
            g.goods_num,
            g.goods_name,
            g.goods_main_image,
            g.goods_main_store_image
        from purchase p
                 join purchase_list pl ON p.purchase_num = pl.purchase_num
                 join goods g ON g.goods_Num = pl.goods_Num
        where p.MEMBER_NUM = #{memberNum}
    </select>
</mapper>